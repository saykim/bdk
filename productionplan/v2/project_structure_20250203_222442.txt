í”„ë¡œì íŠ¸ êµ¬ì¡° ë° ì½”ë“œ ëª¨ìŒ
==================================================
ìƒì„± ì‹œê°„: 2025-02-03 22:24:42
==================================================

[ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° ]
ğŸ“„ .DS_Store
ğŸ“„ app.py
ğŸ“„ project_structure_20250203_222442.txt
ğŸ“„ schema.sql
ğŸ“„ screenshot1.png
ğŸ“ static
    ğŸ“„ scripts.js
    ğŸ“„ style.css
ğŸ“ templates
    ğŸ“„ index.html
    ğŸ“„ products.html

==================================================
[ íŒŒì¼ë³„ ì½”ë“œ ]

[íŒŒì¼ ê²½ë¡œ: app.py]
```import sqlite3
from flask import Flask, request, jsonify, render_template, g
from datetime import datetime, timedelta

app = Flask(__name__)
DATABASE = 'production.db'

def get_db():
    db = getattr(g, '_database', None)
    if db is None:
        db = g._database = sqlite3.connect(DATABASE)
        db.row_factory = sqlite3.Row
    return db

@app.teardown_appcontext
def close_connection(exception):
    db = getattr(g, '_database', None)
    if db is not None:
        db.close()

def init_db():
    with app.app_context():
        db = get_db()
        with app.open_resource('schema.sql') as f:
            db.executescript(f.read().decode('utf8'))
        db.close()

def is_valid_time(time_str):
    try:
        hh, mm = time_str.split(':')
        hh = int(hh)
        mm = int(mm)
        return 0 <= hh < 24 and 0 <= mm <60
    except:
        return False

def calculate_end_datetime(start_date, start_time, duration_hours):
    start_str = f"{start_date} {start_time}"
    start_dt = datetime.strptime(start_str, "%Y-%m-%d %H:%M")
    end_dt = start_dt + timedelta(hours=duration_hours)
    return end_dt.strftime("%Y-%m-%d %H:%M")

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/add_plan', methods=['POST'])
def add_plan():
    try:
        data = request.get_json()
        
        # í•„ìˆ˜ í•„ë“œ ê²€ì¦
        required_fields = ['date', 'start_time', 'duration', 'line', 'product_id', 'product_name', 'bom', 'quantity']
        for field in required_fields:
            if field not in data:
                return jsonify({'success': False, 'message': f'Missing field: {field}'}), 400

        # ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ ê³„ì‚°
        start_datetime = datetime.strptime(f"{data['date']} {data['start_time']}", "%Y-%m-%d %H:%M")
        duration_hours = float(data['duration'])
        end_datetime = start_datetime + timedelta(hours=duration_hours)
        
        conn = get_db()
        cur = conn.cursor()
        
        # ê³„íš ì¶”ê°€
        cur.execute('''
            INSERT INTO plans (date, start_time, duration, end_time, line, product_id, product_name, bom, quantity, notes)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        ''', (
            data['date'],
            data['start_time'],
            duration_hours,
            end_datetime.strftime("%Y-%m-%d %H:%M"),
            data['line'],
            data['product_id'],
            data['product_name'],
            data['bom'],
            data['quantity'],
            data.get('notes', '')
        ))
        
        conn.commit()
        cur.close()
        conn.close()
        
        return jsonify({'success': True})
        
    except Exception as e:
        print('Error:', str(e))  # ì„œë²„ ë¡œê·¸ì— ì—ëŸ¬ ì¶œë ¥
        return jsonify({'success': False, 'message': str(e)}), 400

@app.route('/update_plan/<int:plan_id>', methods=['POST'])
def update_plan(plan_id):
    data = request.json
    date = data.get('date')
    start_time = data.get('startTime')
    duration = data.get('duration')
    line = data.get('line')
    product_name = data.get('productName')
    bom = data.get('bom')
    notes = data.get('notes','')
    quantity = data.get('quantity','0')

    if not date:
        return jsonify({"error":"ì¼ì í•„ìš”"}),400
    if not start_time or not is_valid_time(start_time):
        return jsonify({"error":"ì‹œì‘ì‹œê°„ ì˜¤ë¥˜"}),400
    try:
        d_val = float(duration)
        if d_val<=0 or d_val>24:
            return jsonify({"error":"ìƒì‚°ì‹œê°„ ë²”ìœ„ ì˜¤ë¥˜"}),400
    except:
        return jsonify({"error":"ìƒì‚°ì‹œê°„ ìˆ«ì"}),400
    try:
        l_val = int(line)
        if l_val<1 or l_val>15:
            return jsonify({"error":"ë¼ì¸ ë²”ìœ„"}),400
    except:
        return jsonify({"error":"ë¼ì¸ ìˆ«ì"}),400
    if not product_name:
        return jsonify({"error":"ì œí’ˆëª… í•„ìš”"}),400

    end_str = calculate_end_datetime(date, start_time, float(duration))

    db = get_db()
    db.execute('UPDATE plans SET date=?,start_time=?,duration=?,end_time=?,line=?,product_name=?,bom=?,notes=?,quantity=? WHERE id=?',
               (date, start_time, float(duration), end_str, l_val, product_name, bom, notes, quantity, plan_id))
    db.commit()
    return get_all_plans()

@app.route('/delete_plan/<int:plan_id>', methods=['DELETE'])
def delete_plan(plan_id):
    db = get_db()
    db.execute('DELETE FROM plans WHERE id=?',(plan_id,))
    db.commit()
    return get_all_plans()

@app.route('/done_plan/<int:plan_id>', methods=['PATCH'])
def done_plan(plan_id):
    db = get_db()
    db.execute('UPDATE plans SET done=1 WHERE id=?',(plan_id,))
    db.commit()
    return get_all_plans()

@app.route('/undone_plan/<int:plan_id>', methods=['PATCH'])
def undone_plan(plan_id):
    db = get_db()
    db.execute('UPDATE plans SET done=0 WHERE id=?',(plan_id,))
    db.commit()
    return get_all_plans()

@app.route('/plans', methods=['GET'])
def get_all_plans():
    db = get_db()
    rows = db.execute('SELECT * FROM plans').fetchall()
    plans = [dict(row) for row in rows]
    return jsonify({"plans": plans})

# ê¸°ì¤€ì •ë³´ í˜ì´ì§€
@app.route('/products')
def products_page():
    return render_template('products.html')

@app.route('/get_products', methods=['GET'])
def get_products():
    db = get_db()
    rows = db.execute('SELECT * FROM products').fetchall()
    result = [dict(r) for r in rows]
    return jsonify({"products": result})

@app.route('/add_product', methods=['POST'])
def add_product():
    data = request.json
    product_name = data.get('product_name')
    bom = data.get('bom')
    if not product_name:
        return jsonify({"error":"ì œí’ˆëª… í•„ìš”"}),400
    
    db = get_db()
    db.execute('INSERT INTO products(product_name,bom) VALUES(?,?)',(product_name,bom))
    db.commit()
    return get_products()

@app.route('/update_product/<int:prod_id>', methods=['POST'])
def update_product(prod_id):
    data = request.json
    product_name = data.get('product_name')
    bom = data.get('bom')
    if not product_name:
        return jsonify({"error":"ì œí’ˆëª… í•„ìš”"}),400

    db = get_db()
    db.execute('UPDATE products SET product_name=?,bom=? WHERE id=?',(product_name,bom,prod_id))
    db.commit()
    return get_products()

@app.route('/delete_product/<int:prod_id>', methods=['DELETE'])
def delete_product(prod_id):
    db = get_db()
    db.execute('DELETE FROM products WHERE id=?',(prod_id,))
    db.commit()
    return get_products()

@app.route('/summary', methods=['GET'])
def summary():
    db = get_db()
    rows = db.execute('SELECT date, product_name, bom, SUM(quantity) as total_qty FROM plans WHERE done=1 GROUP BY date, product_name, bom').fetchall()
    result = [dict(r) for r in rows]
    return jsonify({"summary": result})

if __name__ == '__main__':
    init_db()  # DB ì´ˆê¸°í™”
    app.run(debug=True)```
==================================================

[íŒŒì¼ ê²½ë¡œ: schema.sql]
```DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS plans;

CREATE TABLE products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    product_name TEXT NOT NULL,
    bom TEXT NOT NULL
);

CREATE TABLE plans (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date TEXT NOT NULL,
    start_time TEXT NOT NULL,
    duration REAL NOT NULL,
    end_time TEXT NOT NULL,
    line INTEGER NOT NULL,
    product_id INTEGER NOT NULL,
    product_name TEXT NOT NULL,
    bom TEXT NOT NULL,
    quantity INTEGER NOT NULL,
    notes TEXT,
    done INTEGER DEFAULT 0,
    FOREIGN KEY (product_id) REFERENCES products (id)
); ```
==================================================

[íŒŒì¼ ê²½ë¡œ: static/scripts.js]
```// ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
let plans = [];
let products = [];
let productMap = {};
let currentStartDate = new Date();
const tooltip = document.getElementById('tooltip');
let colorMap = {};
const colors = [
    '#3498db', '#e74c3c', '#2ecc71', '#f1c40f', '#9b59b6',
    '#1abc9c', '#e67e22', '#34495e', '#16a085', '#c0392b',
    '#27ae60', '#2980b9', '#8e44ad', '#f39c12', '#d35400'
];

// DOM ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', () => {
    currentStartDate = getWeekStart(new Date());
    getProductsList().then(() => {
        loadData();
    });

    // ì œí’ˆ ì„ íƒ ì‹œ BOM ìë™ ì—…ë°ì´íŠ¸
    const productSelect = document.getElementById('productSelect');
    const bomSelect = document.getElementById('bom');
    
    productSelect.addEventListener('change', function() {
        const selectedProductName = this.value;
        bomSelect.innerHTML = '<option value="">BOM ì„ íƒ</option>';
        
        if (selectedProductName && productMap[selectedProductName]) {
            const products = productMap[selectedProductName];
            console.log('ì„ íƒëœ ì œí’ˆì˜ BOM ëª©ë¡:', products); // ë””ë²„ê¹…ìš©
            
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;  // BOM ì„ íƒ ì‹œ ì œí’ˆ ID ì €ì¥
                option.textContent = product.bom;
                bomSelect.appendChild(option);
            });
        }
    });
});

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
function getWeekStart(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    d.setDate(diff);
    d.setHours(0,0,0,0);
    return d;
}

// ë„¤ë¹„ê²Œì´ì…˜ í•¨ìˆ˜ë“¤
function prevWeek() {
    currentStartDate.setDate(currentStartDate.getDate() - 7);
    renderGantt();
}

function nextWeek() {
    currentStartDate.setDate(currentStartDate.getDate() + 7);
    renderGantt();
}

function currentWeek() {
    currentStartDate = getWeekStart(new Date());
    renderGantt();
}

// ë°ì´í„° ê´€ë ¨ í•¨ìˆ˜ë“¤
function getProductsList() {
    return fetch('/get_products')
        .then(res => res.json())
        .then(data => {
            console.log('ì„œë²„ ì‘ë‹µ:', data); // ë””ë²„ê¹…ìš©
            products = data.products;
            productMap = {};  // productMap ì´ˆê¸°í™”
            
            const productSelect = document.getElementById('productSelect');
            productSelect.innerHTML = '<option value="">ì œí’ˆ ì„ íƒ</option>';
            
            // ì œí’ˆëª…ìœ¼ë¡œ ê·¸ë£¹í™”
            const uniqueProductNames = new Set();
            products.forEach(product => {
                uniqueProductNames.add(product.product_name);
                productMap[product.product_name] = products.filter(p => 
                    p.product_name === product.product_name
                );
            });
            
            // ê³ ìœ í•œ ì œí’ˆëª…ë§Œ ì¶”ê°€
            uniqueProductNames.forEach(productName => {
                const option = document.createElement('option');
                option.value = productName;
                option.textContent = productName;
                productSelect.appendChild(option);
            });
        });
}

function addPlan() {
    const productName = document.getElementById('productSelect').value;
    const selectedProductId = document.getElementById('bom').value;
    
    if (!productName || !selectedProductId) {
        alert('ì œí’ˆê³¼ BOMì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    // ì„ íƒëœ ì œí’ˆ ì •ë³´ ì°¾ê¸°
    const selectedProduct = products.find(p => p.id.toString() === selectedProductId);
    if (!selectedProduct) {
        alert('ì„ íƒëœ ì œí’ˆ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }

    // í•„ìˆ˜ ì…ë ¥ê°’ ê²€ì¦
    const date = document.getElementById('date').value;
    const startTime = document.getElementById('startTime').value;
    const duration = document.getElementById('duration').value;
    const line = document.getElementById('line').value;
    const quantity = document.getElementById('quantity').value;

    if (!date || !startTime || !duration || !line || !quantity) {
        alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    const data = {
        date: date,
        start_time: startTime,
        duration: parseFloat(duration),
        line: parseInt(line),
        product_id: parseInt(selectedProductId),
        product_name: selectedProduct.product_name,
        bom: selectedProduct.bom,
        quantity: parseInt(quantity),
        notes: document.getElementById('notes').value || ''
    };

    console.log('ì„œë²„ë¡œ ë³´ë‚´ëŠ” ë°ì´í„°:', data); // ë””ë²„ê¹…ìš©

    fetch('/add_plan', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(res => {
        if (!res.ok) {
            return res.json().then(err => {
                throw new Error(err.message || 'ê³„íš ì¶”ê°€ ì‹¤íŒ¨');
            });
        }
        return res.json();
    })
    .then(result => {
        if (result.success) {
            loadData();
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('date').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('duration').value = '';
            document.getElementById('line').value = '';
            document.getElementById('productSelect').value = '';
            document.getElementById('bom').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('notes').value = '';
        } else {
            alert('ê³„íš ì¶”ê°€ ì‹¤íŒ¨: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert(error.message);
    });
}

// ë Œë”ë§ í•¨ìˆ˜ë“¤
function renderYAxis() {
    const ganttLines = document.querySelector('.gantt-lines');
    ganttLines.innerHTML = '';

    const lineLabelsContainer = document.createElement('div');
    lineLabelsContainer.className = 'line-labels-container';

    // ìœ„ì¹˜ ê¸°ì¤€ ì„¤ì • - ë†’ì´ ì¦ê°€
    lineLabelsContainer.style.position = 'relative';
    lineLabelsContainer.style.height = (15 * 45) + 'px'; // 30pxì—ì„œ 45pxë¡œ ì¦ê°€
    lineLabelsContainer.style.width = '50px';

    for (let i = 1; i <= 15; i++) {
        const lineLabel = document.createElement('div');
        lineLabel.className = 'line-label';
        lineLabel.textContent = i + 'í˜¸ê¸°';

        lineLabel.style.position = 'absolute';
        lineLabel.style.top = ((i - 1) * 45) + 'px'; // 30pxì—ì„œ 45pxë¡œ ì¦ê°€
        lineLabel.style.height = '45px'; // 30pxì—ì„œ 45pxë¡œ ì¦ê°€
        lineLabel.style.lineHeight = '45px'; // 30pxì—ì„œ 45pxë¡œ ì¦ê°€
        lineLabel.style.whiteSpace = 'nowrap';

        lineLabelsContainer.appendChild(lineLabel);
    }

    ganttLines.appendChild(lineLabelsContainer);
}

function renderGantt() {
    renderYAxis();
    
    const ganttGrid = document.querySelector('.gantt-grid');
    const dateScale = document.querySelector('.date-scale');
    const timeScale = document.querySelector('.time-scale');

    // ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ì²˜ë¦¬
    if (plans.length === 0) {
        timeScale.innerHTML = '';
        dateScale.innerHTML = '';
        ganttGrid.innerHTML = '';
        return;
    }

    // ì£¼ê°„ ë‚ ì§œ ë²”ìœ„ ì„¤ì •
    let weekEnd = new Date(currentStartDate);
    weekEnd.setDate(weekEnd.getDate() + 7);

    // ë‚ ì§œ ìŠ¤ì¼€ì¼ ë Œë”ë§
    dateScale.innerHTML = '';
    for (let d = new Date(currentStartDate); d < weekEnd; d.setDate(d.getDate() + 1)) {
        const marker = document.createElement('div');
        marker.className = 'date-marker';
        const leftPercent = ((d - currentStartDate) / (weekEnd - currentStartDate)) * 100;
        marker.style.left = leftPercent + '%';
        marker.textContent = `${d.getMonth()+1}/${d.getDate()}`;
        dateScale.appendChild(marker);
    }

    // ì‹œê°„ ìŠ¤ì¼€ì¼ ë Œë”ë§
    timeScale.innerHTML = '';
    for (let h = 0; h < 24; h += 2) {
        const marker = document.createElement('div');
        marker.className = 'time-marker';
        marker.style.left = (h / 24 * 100) + '%';
        marker.textContent = `${String(h).padStart(2,'0')}:00`;
        timeScale.appendChild(marker);
    }

    // ê²©ì ìƒì„±
    ganttGrid.innerHTML = '';
    for (let i = 0; i < 15; i++) {
        const row = document.createElement('div');
        row.className = 'gantt-row';
        row.style.top = (i * 45) + 'px';  // 30pxì—ì„œ 45pxë¡œ ì¦ê°€
        ganttGrid.appendChild(row);
    }

    // ê°„íŠ¸ ë°” ë Œë”ë§
    plans.forEach(plan => {
        const startDate = new Date(plan.date + 'T' + plan.start_time);
        const endDate = new Date(plan.end_time.replace(' ', 'T'));
        
        // í˜„ì¬ í‘œì‹œ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©´ ê±´ë„ˆë›°ê¸°
        if (startDate >= weekEnd || endDate <= currentStartDate) return;
        
        const totalMs = weekEnd - currentStartDate;
        const leftPercent = Math.max(0, (startDate - currentStartDate) / totalMs * 100);
        const widthPercent = Math.min(100 - leftPercent, (endDate - startDate) / totalMs * 100);

        const bar = document.createElement('div');
        bar.className = 'gantt-bar' + (plan.done ? ' done' : '');
        
        // ìœ„ì¹˜ì™€ í¬ê¸° ì„¤ì •
        bar.style.left = leftPercent + '%';
        bar.style.width = widthPercent + '%';
        bar.style.top = ((plan.line - 1) * 45) + 'px';  // 30pxì—ì„œ 45pxë¡œ ì¦ê°€
        bar.style.height = '39px';  // 24pxì—ì„œ 39pxë¡œ ì¦ê°€
        
        // ì œí’ˆëª…ê³¼ BOMì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
        if (!plan.done) {
            bar.style.background = getColorForProduct(plan.product_name, plan.bom);
        }
        
        // ì œí’ˆëª…ê³¼ BOM í•¨ê»˜ í‘œì‹œ
        bar.textContent = `${plan.product_name} (${plan.bom})`;
        
        // íˆ´íŒ ì´ë²¤íŠ¸
        bar.addEventListener('mouseover', (e) => {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = `
                <div>ì œí’ˆ: ${plan.product_name}</div>
                <div>BOM: ${plan.bom}</div>
                <div>ìˆ˜ëŸ‰: ${plan.quantity}</div>
                <div>ì‹œì‘: ${plan.start_time}</div>
                <div>ì¢…ë£Œ: ${plan.end_time}</div>
                ${plan.notes ? `<div>ë¹„ê³ : ${plan.notes}</div>` : ''}
            `;
            tooltip.style.display = 'block';
            tooltip.style.left = e.pageX + 10 + 'px';
            tooltip.style.top = e.pageY + 10 + 'px';
        });
        
        bar.addEventListener('mousemove', (e) => {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = e.pageX + 10 + 'px';
            tooltip.style.top = e.pageY + 10 + 'px';
        });

        bar.addEventListener('mouseout', () => {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        });

        ganttGrid.appendChild(bar);
    });
}

function renderTable() {
    const tbody = document.querySelector('#planTable tbody');
    tbody.innerHTML = '';
    plans.forEach(plan => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${plan.id}</td>
            <td>${plan.date}</td>
            <td>${plan.start_time}</td>
            <td>${plan.duration}</td>
            <td>${plan.end_time}</td>
            <td>${plan.line}</td>
            <td>${plan.product_name}</td>
            <td>${plan.bom}</td>
            <td>${plan.quantity}</td>
            <td>${plan.notes}</td>
            <td>
                <button onclick="editPlan(${plan.id})">ìˆ˜ì •</button>
                <button onclick="deletePlan(${plan.id})">ì‚­ì œ</button>
                ${plan.done == 1 ? 
                    `<button onclick="undonePlan(${plan.id})">ì™„ë£Œì·¨ì†Œ</button>` :
                    `<button onclick="donePlan(${plan.id})">ì™„ë£Œ</button>`}
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function renderSummary() {
    fetch('/summary')
        .then(res => res.json())
        .then(data => {
            const tbody = document.querySelector('#summaryTable tbody');
            tbody.innerHTML = '';
            data.summary.forEach(s => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${s.date}</td>
                    <td>${s.product_name}</td>
                    <td>${s.bom}</td>
                    <td>${s.total_qty}</td>
                `;
                tbody.appendChild(tr);
            });
        });
}

// CRUD ì‘ì—… í•¨ìˆ˜ë“¤
function editPlan(id) {
    const plan = plans.find(p => p.id === id);
    if (!plan) return;

    // ìˆ˜ì • ë¡œì§ êµ¬í˜„
    // ...
}

function deletePlan(id) {
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    fetch(`/delete_plan/${id}`, { method: 'DELETE' })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                loadData();
            } else {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + result.message);
            }
        });
}

function donePlan(id) {
    fetch(`/done_plan/${id}`, { method: 'POST' })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                loadData();
            } else {
                alert('ì™„ë£Œ ì²˜ë¦¬ ì‹¤íŒ¨: ' + result.message);
            }
        });
}

function undonePlan(id) {
    fetch(`/undone_plan/${id}`, { method: 'POST' })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                loadData();
            } else {
                alert('ì™„ë£Œ ì·¨ì†Œ ì‹¤íŒ¨: ' + result.message);
            }
        });
}

// ë°ì´í„° ë¡œë“œ
function loadData() {
    fetch('/plans')
        .then(res => res.json())
        .then(data => {
            plans = data.plans;
            renderTable();
            renderGantt();
            renderSummary();
        });
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
window.addEventListener('resize', renderGantt);

// ì œí’ˆëª…+BOM ì¡°í•©ì— ëŒ€í•œ ìƒ‰ìƒ ìƒì„± í•¨ìˆ˜
function getColorForProduct(productName, bom) {
    const key = `${productName}-${bom}`;
    if (!colorMap[key]) {
        // ê°™ì€ ì œí’ˆëª…ì€ ë¹„ìŠ·í•œ ìƒ‰ìƒ ê³„ì—´ì„ ì‚¬ìš©
        const existingProduct = Object.keys(colorMap).find(k => k.startsWith(productName + '-'));
        if (existingProduct) {
            // ê¸°ì¡´ ìƒ‰ìƒì„ ê¸°ë°˜ìœ¼ë¡œ ì•½ê°„ ë‹¤ë¥¸ ìƒ‰ì¡° ìƒì„±
            const baseColor = colorMap[existingProduct];
            const hslColor = rgbToHsl(hexToRgb(baseColor));
            hslColor.h = (hslColor.h + 0.1) % 1; // ìƒ‰ì¡°ë§Œ ì•½ê°„ ë³€ê²½
            colorMap[key] = hslToHex(hslColor);
        } else {
            // ìƒˆë¡œìš´ ì œí’ˆëª…ì´ë©´ ìƒˆë¡œìš´ ìƒ‰ìƒ í• ë‹¹
            const unusedColors = colors.filter(c => !Object.values(colorMap).includes(c));
            colorMap[key] = unusedColors.length > 0 ? unusedColors[0] : colors[Math.floor(Math.random() * colors.length)];
        }
    }
    return colorMap[key];
}

// ìƒ‰ìƒ ë³€í™˜ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
function hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
}

function rgbToHsl(rgb) {
    let r = rgb.r / 255, g = rgb.g / 255, b = rgb.b / 255;
    const max = Math.max(r, g, b), min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;

    if (max === min) {
        h = s = 0;
    } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
    }
    return { h, s, l };
}

function hslToHex({ h, s, l }) {
    let r, g, b;
    if (s === 0) {
        r = g = b = l;
    } else {
        const hue2rgb = (p, q, t) => {
            if (t < 0) t += 1;
            if (t > 1) t -= 1;
            if (t < 1/6) return p + (q - p) * 6 * t;
            if (t < 1/2) return q;
            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
    }
    const toHex = x => {
        const hex = Math.round(x * 255).toString(16);
        return hex.length === 1 ? '0' + hex : hex;
    };
    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
}
```
==================================================

[íŒŒì¼ ê²½ë¡œ: static/style.css]
```/* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
body { 
    font-family: Arial, sans-serif; 
    margin: 20px; 
}

/* í¼ ì»¨í…Œì´ë„ˆ */
.form-container { 
    display: flex; 
    gap: 10px; 
    flex-wrap: wrap; 
    margin-bottom: 20px; 
}

.form-container input, 
.form-container button, 
.form-container select { 
    padding: 5px; 
    border: 1px solid #ccc; 
    border-radius: 4px; 
}

.form-container button { 
    background: #007bff; 
    color: #fff; 
    cursor: pointer; 
}

/* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
table { 
    border-collapse: collapse; 
    width: 100%; 
    margin-top: 20px; 
}

th, td { 
    border: 1px solid #ccc; 
    padding: 8px; 
    text-align: center; 
}

.done-row { 
    background: #f5f5f5; 
}

/* ê°„íŠ¸ ì°¨íŠ¸ */
.gantt-wrapper {
    display: flex;
    height: 510px; /* í—¤ë”(60px) + 15ì¤„(30px*15) */
    overflow-y: auto;
    border: 1px solid #ddd;
    background: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.gantt-lines {
    flex: 0 0 80px;
    background: #f8f9fa;
    border-right: 1px solid #ddd;
    position: sticky;
    left: 0;
    z-index: 2;
    padding-top: 60px; /* í—¤ë” ë†’ì´ë§Œí¼ íŒ¨ë”© */
}

.line-labels-container {
    position: relative;
    width: 100%;
    background: #f8f9fa;
}

.line-label {
    position: absolute;
    width: 100%;
    text-align: center;
    font-size: 12px;
    color: #333;
    border-bottom: 1px solid #eee;
    padding: 0 5px;
    box-sizing: border-box;
}

.gantt-grid {
    position: relative;
    height: calc(15 * 30px); /* 15í–‰ * 30px */
}

.gantt-row {
    position: absolute;
    width: 100%;
    height: 30px;
    border-bottom: 1px solid #eee;
}

.gantt-container {
    flex: 1;
    overflow-x: auto;
    position: relative;
    min-width: 0;
}

.gantt-header {
    height: 50px;
    position: sticky;
    top: 0;
    background: #fff;
    z-index: 3;
    border-bottom: 2px solid #ddd;
}

.time-scale {
    position: relative;
    height: 100%;
}

.time-marker {
    position: absolute;
    transform: translateX(-50%);
    font-size: 11px;
    color: #666;
    padding: 5px;
    border-left: 1px solid #ddd;
    height: 100%;
    display: flex;
    align-items: center;
}

.gantt-bar {
    position: absolute;
    height: 24px;
    background: #3498db;
    color: #fff;
    font-size: 12px;
    border-radius: 3px;
    padding: 0 8px;
    display: flex;
    align-items: center;
    margin-top: 3px;
    cursor: pointer;
    z-index: 1;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    transition: all 0.2s;
}

.gantt-bar:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

.gantt-bar.done {
    background: #95a5a6;
}

.shift-line {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 0;
    border-left: 2px dashed #ff6b6b;
    z-index: 1;
}

.shift-label {
    position: absolute;
    top: 5px;
    transform: translateX(-50%);
    background: #ff6b6b;
    color: white;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 3px;
    z-index: 2;
}

.tooltip {
    position: fixed;
    background: rgba(0,0,0,0.8);
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 1000;
    pointer-events: none;
    max-width: 300px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* ìš”ì•½ í…Œì´ë¸” */
.summary-table {
    margin-top: 20px;
    width: 100%;
}

.summary-table th,
.summary-table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}

.summary-table th {
    background: #f8f9fa;
}

/* ê°„íŠ¸ ì°¨íŠ¸ ë„¤ë¹„ê²Œì´ì…˜ */
.nav-buttons {
    margin: 10px 0;
}

.nav-buttons button {
    padding: 5px 15px;
    margin-right: 10px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.nav-buttons button:hover {
    background: #0056b3;
}

/* ê°„íŠ¸ ì°¨íŠ¸ í—¤ë” */
.gantt-header {
    position: sticky;
    top: 0;
    height: 60px; /* ë‚ ì§œì™€ ì‹œê°„ ëˆˆê¸ˆì„ ìœ„í•œ ê³µê°„ */
    background: white;
    z-index: 3;
    border-bottom: 2px solid #ddd;
}

.date-scale {
    position: absolute;
    top: 0;
    width: 100%;
    height: 30px;
    border-bottom: 1px solid #ddd;
}

.time-scale {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 30px;
    border-top: 1px solid #ddd;
}

.date-marker {
    position: absolute;
    transform: translateX(-50%);
    padding: 5px;
    font-weight: bold;
    font-size: 11px;
    color: #333;
}

.time-marker {
    position: absolute;
    transform: translateX(-50%);
    padding: 5px;
    font-size: 10px;
    color: #666;
}

/* ê°„íŠ¸ ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìˆ˜ì • */
.gantt-container {
    position: relative;
    flex: 1;
    overflow-x: auto;
    background: #fff;
    min-height: 480px;
}

.gantt-grid {
    position: relative;
    padding-top: 60px; /* í—¤ë” ë†’ì´ë§Œí¼ íŒ¨ë”© */
}

.gantt-row {
    height: 30px;
    border-bottom: 1px solid #eee;
    background: #fafafa;
}

/* êµëŒ€ ì‹œê°„ ë¼ì¸ */
.shift-lines {
    position: absolute;
    top: 60px; /* í—¤ë” ë†’ì´ë§Œí¼ ë„ì›€ */
    bottom: 0;
    width: 100%;
    pointer-events: none;
}

.shift-line {
    position: absolute;
    top: 0;
    height: 100%;
    border-left: 2px dashed #ff6b6b;
}

.shift-label {
    position: absolute;
    top: -25px;
    transform: translateX(-50%);
    background: #ff6b6b;
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 11px;
}

/* ê°„íŠ¸ ë°” ìŠ¤íƒ€ì¼ ê°œì„  */
.gantt-bar {
    position: absolute;
    height: 24px;
    background: linear-gradient(to bottom, #3498db, #2980b9);
    color: white;
    font-size: 12px;
    border-radius: 3px;
    padding: 0 8px;
    display: flex;
    align-items: center;
    margin-top: 3px;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: all 0.2s;
    z-index: 1;
}

.gantt-bar:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.gantt-bar.done {
    background: linear-gradient(to bottom, #95a5a6, #7f8c8d);
}

/* Yì¶• ë¼ì¸ ë¼ë²¨ ê°œì„  */
.gantt-lines {
    padding-top: 60px; /* í—¤ë” ë†’ì´ë§Œí¼ íŒ¨ë”© */
}

.line-label {
    position: absolute;
    width: 100%;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: #666;
    background: #f8f9fa;
    border-bottom: 1px solid #eee;
}

/* íˆ´íŒ ê°œì„  */
.tooltip {
    position: fixed;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 1000;
    pointer-events: none;
    max-width: 300px;
    line-height: 1.4;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* ê° í–‰ì˜ ìœ„ì¹˜ ì„¤ì • */
.gantt-row:nth-child(1) { top: 0px; }
.gantt-row:nth-child(2) { top: 30px; }
.gantt-row:nth-child(3) { top: 60px; }
/* ... ì´í•˜ ìƒëµ ... */

.btn-products {
    background-color: #2ecc71;
    color: white;
    padding: 6px 15px;
    border-radius: 4px;
    text-decoration: none;
    font-weight: bold;
    display: inline-flex;
    align-items: center;
    transition: background-color 0.3s;
    border: none;
    cursor: pointer;
    height: 28px;
}

.btn-products:hover {
    background-color: #27ae60;
}

.btn-products:active {
    transform: translateY(1px);
}

/* form-container ë‚´ë¶€ ë²„íŠ¼ë“¤ ì •ë ¬ */
.form-container button,
.form-container .btn-products {
    margin-left: 5px;
}
```
==================================================

[íŒŒì¼ ê²½ë¡œ: templates/index.html]
```<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìƒì‚° ê³„íš ê´€ë¦¬</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<h1>ìƒì‚° ê³„íš ê´€ë¦¬</h1>
<div class="form-container">
  <input type="date" id="date">
  <input type="time" id="startTime">
  <input type="number" step="0.5" id="duration" placeholder="ìƒì‚°ì‹œê°„(h)">
  <input type="number" id="line" placeholder="ë¼ì¸(1~15)">
  <select id="productSelect">
    <option value="">ì œí’ˆ ì„ íƒ</option>
  </select>
  <select id="bom">
    <option value="">BOM ì„ íƒ</option>
  </select>
  <input type="number" id="quantity" placeholder="ìƒì‚°ìˆ˜ëŸ‰">
  <input type="text" id="notes" placeholder="íŠ¹ì´ì‚¬í•­">
  <button onclick="addPlan()">ê³„íš ì¶”ê°€</button>
  <a href="/products" class="btn-products">ì œí’ˆ ê´€ë¦¬</a>
</div>

<table id="planTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>ì¼ì</th>
      <th>ì‹œì‘ ì‹œê°„</th>
      <th>ìƒì‚°ì‹œê°„</th>
      <th>ì¢…ë£Œ ì‹œê°„</th>
      <th>ë¼ì¸</th>
      <th>ì œí’ˆëª…</th>
      <th>BOM</th>
      <th>ìˆ˜ëŸ‰</th>
      <th>íŠ¹ì´ì‚¬í•­</th>
      <th>ì‘ì—…</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>ìƒì‚° ê³„íš ê°„íŠ¸ ì°¨íŠ¸</h3>
<div class="nav-buttons">
  <button onclick="prevWeek()">ì´ì „ ì£¼</button>
  <button onclick="nextWeek()">ë‹¤ìŒ ì£¼</button>
  <button onclick="currentWeek()">ì´ë²ˆ ì£¼</button>
</div>

<div class="gantt-wrapper">
  <div class="gantt-lines line-numbers">
    <!-- Yì¶• ë¼ì¸ ë¼ë²¨ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
  </div>
  <div class="gantt-container">
    <div class="gantt-header">
      <div class="date-scale">
        <!-- ìƒë‹¨ ë‚ ì§œ ëˆˆê¸ˆì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
      </div>
      <div class="time-scale">
        <!-- í•˜ë‹¨ ì‹œê°„ ëˆˆê¸ˆì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
      </div>
    </div>
    <div class="gantt-grid">
      <!-- ê²©ìì™€ ê°„íŠ¸ ë°”ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
    </div>
    <div class="shift-lines">
      <div class="shift-line" id="shift7"><div class="shift-label">07:00</div></div>
      <div class="shift-line" id="shift15"><div class="shift-label">15:00</div></div>
      <div class="shift-line" id="shift23"><div class="shift-label">23:00</div></div>
    </div>
  </div>
</div>
<div class="tooltip" id="tooltip"></div>

<h3>ì™„ë£Œ ì²˜ë¦¬ëœ ìƒì‚°ëŸ‰ ìš”ì•½</h3>
<table class="summary-table" id="summaryTable">
  <thead>
    <tr>
      <th>ì¼ì</th>
      <th>ì œí’ˆëª…</th>
      <th>BOM</th>
      <th>ì´ ìƒì‚°ìˆ˜ëŸ‰</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="{{ url_for('static', filename='scripts.js') }}"></script>
</body>
</html>```
==================================================

[íŒŒì¼ ê²½ë¡œ: templates/products.html]
```<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì œí’ˆ ê¸°ì¤€ì •ë³´ ê´€ë¦¬</title>
<style>
  body { font-family:Arial, sans-serif; margin:20px; }
  table { border-collapse:collapse; width:100%; margin-top:20px; }
  th,td { border:1px solid #ccc; padding:8px; text-align:center; }
  
  /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .btn-container {
    margin: 20px 0;
    display: flex;
    gap: 10px;
  }
  
  .btn-back {
    background-color: #3498db;
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    text-decoration: none;
    font-weight: bold;
    transition: background-color 0.3s;
  }
  
  .btn-back:hover {
    background-color: #2980b9;
  }
</style>
</head>
<body>
<h1>ê¸°ì¤€ì •ë³´ ê´€ë¦¬</h1>

<!-- ëŒì•„ê°€ê¸° ë²„íŠ¼ ì¶”ê°€ -->
<div class="btn-container">
  <a href="/" class="btn-back">â† ìƒì‚°ê³„íšìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
</div>

<div>
  <input type="text" id="product_name" placeholder="ì œí’ˆëª…">
  <input type="text" id="bom" placeholder="BOM">
  <button onclick="addProduct()">ì¶”ê°€</button>
</div>

<table id="productTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>ì œí’ˆëª…</th>
      <th>BOM</th>
      <th>ì‘ì—…</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let products = [];

function getProducts(){
  fetch('/get_products')
  .then(res=>res.json())
  .then(data=>{
    products = data.products;
    renderTable();
  })
}

function renderTable(){
  const tbody = document.querySelector('#productTable tbody');
  tbody.innerHTML='';
  products.forEach(p=>{
    const tr = document.createElement('tr');
    tr.innerHTML=`
      <td>${p.id}</td>
      <td>${p.product_name}</td>
      <td>${p.bom||''}</td>
      <td>
        <button onclick="editProduct(${p.id})">ìˆ˜ì •</button>
        <button onclick="deleteProduct(${p.id})">ì‚­ì œ</button>
      </td>
    `;
    tbody.appendChild(tr);
  })
}

function addProduct(){
  const product_name = document.getElementById('product_name').value;
  const bom = document.getElementById('bom').value;
  fetch('/add_product',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({product_name,bom})
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.error) {alert(data.error); return;}
    products = data.products;
    renderTable();
    clearForm();
  })
}

function clearForm(){
  document.getElementById('product_name').value='';
  document.getElementById('bom').value='';
}

function editProduct(id){
  const prod = products.find(x=>x.id===id);
  if(!prod) return;
  const product_name = prompt('ì œí’ˆëª…', prod.product_name);
  if(!product_name)return;
  const bom = prompt('BOM', prod.bom);
  fetch(`/update_product/${id}`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({product_name,bom})
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.error){alert(data.error);return;}
    products = data.products;
    renderTable();
  })
}

function deleteProduct(id){
  if(!confirm('ì‚­ì œ?'))return;
  fetch(`/delete_product/${id}`,{method:'DELETE'})
  .then(res=>res.json())
  .then(data=>{
    if(data.error){alert(data.error);return;}
    products = data.products;
    renderTable();
  })
}

getProducts();
</script>
</body>
</html>```
==================================================
